(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const c of document.querySelectorAll('link[rel="modulepreload"]'))r(c);new MutationObserver(c=>{for(const o of c)if(o.type==="childList")for(const i of o.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&r(i)}).observe(document,{childList:!0,subtree:!0});function n(c){const o={};return c.integrity&&(o.integrity=c.integrity),c.referrerpolicy&&(o.referrerPolicy=c.referrerpolicy),c.crossorigin==="use-credentials"?o.credentials="include":c.crossorigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function r(c){if(c.ep)return;c.ep=!0;const o=n(c);fetch(c.href,o)}})();function h(){}function we(t){return t&&typeof t=="object"&&typeof t.then=="function"}function me(t){return t()}function ce(){return Object.create(null)}function P(t){t.forEach(me)}function $e(t){return typeof t=="function"}function J(t,e){return t!=t?e==e:t!==e||t&&typeof t=="object"||typeof t=="function"}let U;function oe(t,e){return U||(U=document.createElement("a")),U.href=e,t===U.href}function Ce(t){return Object.keys(t).length===0}function v(t,e){t.appendChild(e)}function k(t,e,n){t.insertBefore(e,n||null)}function m(t){t.parentNode.removeChild(t)}function K(t,e){for(let n=0;n<t.length;n+=1)t[n]&&t[n].d(e)}function _(t){return document.createElement(t)}function Q(t){return document.createTextNode(t)}function O(){return Q(" ")}function be(){return Q("")}function D(t,e,n,r){return t.addEventListener(e,n,r),()=>t.removeEventListener(e,n,r)}function g(t,e,n){n==null?t.removeAttribute(e):t.getAttribute(e)!==n&&t.setAttribute(e,n)}function Ee(t){return Array.from(t.childNodes)}function Le(t,e){e=""+e,t.wholeText!==e&&(t.data=e)}function le(t,e,n){t.classList[n?"add":"remove"](e)}function je(t,e,{bubbles:n=!1,cancelable:r=!1}={}){const c=document.createEvent("CustomEvent");return c.initCustomEvent(t,n,r,e),c}let R;function $(t){R=t}function V(){if(!R)throw new Error("Function called outside component initialization");return R}function Oe(t){V().$$.on_mount.push(t)}function Pe(){const t=V();return(e,n,{cancelable:r=!1}={})=>{const c=t.$$.callbacks[e];if(c){const o=je(e,n,{cancelable:r});return c.slice().forEach(i=>{i.call(t,o)}),!o.defaultPrevented}return!0}}const N=[],F=[],T=[],se=[],Ie=Promise.resolve();let G=!1;function Me(){G||(G=!0,Ie.then(W))}function H(t){T.push(t)}const q=new Set;let S=0;function W(){const t=R;do{for(;S<N.length;){const e=N[S];S++,$(e),Ae(e.$$)}for($(null),N.length=0,S=0;F.length;)F.pop()();for(let e=0;e<T.length;e+=1){const n=T[e];q.has(n)||(q.add(n),n())}T.length=0}while(N.length);for(;se.length;)se.pop()();G=!1,q.clear(),$(t)}function Ae(t){if(t.fragment!==null){t.update(),P(t.before_update);const e=t.dirty;t.dirty=[-1],t.fragment&&t.fragment.p(t.ctx,e),t.after_update.forEach(H)}}const z=new Set;let L;function ve(){L={r:0,c:[],p:L}}function ke(){L.r||P(L.c),L=L.p}function E(t,e){t&&t.i&&(z.delete(t),t.i(e))}function j(t,e,n,r){if(t&&t.o){if(z.has(t))return;z.add(t),L.c.push(()=>{z.delete(t),r&&(n&&t.d(1),r())}),t.o(e)}else r&&r()}function Ne(t,e){const n=e.token={};function r(c,o,i,f){if(e.token!==n)return;e.resolved=f;let l=e.ctx;i!==void 0&&(l=l.slice(),l[i]=f);const s=c&&(e.current=c)(l);let a=!1;e.block&&(e.blocks?e.blocks.forEach((u,p)=>{p!==o&&u&&(ve(),j(u,1,1,()=>{e.blocks[p]===u&&(e.blocks[p]=null)}),ke())}):e.block.d(1),s.c(),E(s,1),s.m(e.mount(),e.anchor),a=!0),e.block=s,e.blocks&&(e.blocks[o]=s),a&&W()}if(we(t)){const c=V();if(t.then(o=>{$(c),r(e.then,1,e.value,o),$(null)},o=>{if($(c),r(e.catch,2,e.error,o),$(null),!e.hasCatch)throw o}),e.current!==e.pending)return r(e.pending,0),!0}else{if(e.current!==e.then)return r(e.then,1,e.value,t),!0;e.resolved=t}}function Re(t,e,n){const r=e.slice(),{resolved:c}=t;t.current===t.then&&(r[t.value]=c),t.current===t.catch&&(r[t.error]=c),t.block.p(r,n)}function ye(t){t&&t.c()}function X(t,e,n,r){const{fragment:c,on_mount:o,on_destroy:i,after_update:f}=t.$$;c&&c.m(e,n),r||H(()=>{const l=o.map(me).filter($e);i?i.push(...l):P(l),t.$$.on_mount=[]}),f.forEach(H)}function Y(t,e){const n=t.$$;n.fragment!==null&&(P(n.on_destroy),n.fragment&&n.fragment.d(e),n.on_destroy=n.fragment=null,n.ctx=[])}function Be(t,e){t.$$.dirty[0]===-1&&(N.push(t),Me(),t.$$.dirty.fill(0)),t.$$.dirty[e/31|0]|=1<<e%31}function Z(t,e,n,r,c,o,i,f=[-1]){const l=R;$(t);const s=t.$$={fragment:null,ctx:null,props:o,update:h,not_equal:c,bound:ce(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(e.context||(l?l.$$.context:[])),callbacks:ce(),dirty:f,skip_bound:!1,root:e.target||l.$$.root};i&&i(s.root);let a=!1;if(s.ctx=n?n(t,e.props||{},(u,p,...d)=>{const b=d.length?d[0]:p;return s.ctx&&c(s.ctx[u],s.ctx[u]=b)&&(!s.skip_bound&&s.bound[u]&&s.bound[u](b),a&&Be(t,u)),p}):[],s.update(),a=!0,P(s.before_update),s.fragment=r?r(s.ctx):!1,e.target){if(e.hydrate){const u=Ee(e.target);s.fragment&&s.fragment.l(u),u.forEach(m)}else s.fragment&&s.fragment.c();e.intro&&E(t.$$.fragment),X(t,e.target,e.anchor,e.customElement),W()}$(l)}class ee{$destroy(){Y(this,1),this.$destroy=h}$on(e,n){const r=this.$$.callbacks[e]||(this.$$.callbacks[e]=[]);return r.push(n),()=>{const c=r.indexOf(n);c!==-1&&r.splice(c,1)}}$set(e){this.$$set&&!Ce(e)&&(this.$$.skip_bound=!0,this.$$set(e),this.$$.skip_bound=!1)}}function ie(t,e,n){const r=t.slice();return r[9]=e[n],r[11]=n,r}function ae(t,e,n){const r=t.slice();return r[12]=e[n],r}function ue(t){let e,n,r=t[0].category+"",c,o,i,f,l=t[0].images,s=[];for(let u=0;u<l.length;u+=1)s[u]=fe(ae(t,l,u));let a=t[1].palettes&&de(t);return{c(){e=_("fieldset"),n=_("legend"),c=Q(r),o=O(),i=_("div");for(let u=0;u<s.length;u+=1)s[u].c();f=O(),a&&a.c(),g(i,"class","images svelte-1vk5jf9")},m(u,p){k(u,e,p),v(e,n),v(n,c),v(e,o),v(e,i);for(let d=0;d<s.length;d+=1)s[d].m(i,null);v(e,f),a&&a.m(e,null)},p(u,p){if(p&1&&r!==(r=u[0].category+"")&&Le(c,r),p&11){l=u[0].images;let d;for(d=0;d<l.length;d+=1){const b=ae(u,l,d);s[d]?s[d].p(b,p):(s[d]=fe(b),s[d].c(),s[d].m(i,null))}for(;d<s.length;d+=1)s[d].d(1);s.length=l.length}u[1].palettes?a?a.p(u,p):(a=de(u),a.c(),a.m(e,null)):a&&(a.d(1),a=null)},d(u){u&&m(e),K(s,u),a&&a.d()}}}function fe(t){let e,n,r,c,o,i;function f(){return t[5](t[12])}return{c(){e=_("div"),n=_("img"),c=O(),oe(n.src,r=URL.createObjectURL(t[12].blob))||g(n,"src",r),g(n,"alt",""),g(e,"class","image-select svelte-1vk5jf9"),le(e,"selected",t[1].image===t[12])},m(l,s){k(l,e,s),v(e,n),v(e,c),o||(i=D(e,"click",f),o=!0)},p(l,s){t=l,s&1&&!oe(n.src,r=URL.createObjectURL(t[12].blob))&&g(n,"src",r),s&3&&le(e,"selected",t[1].image===t[12])},d(l){l&&m(e),o=!1,i()}}}function de(t){let e,n,r,c=Object.entries(t[1].palettes),o=[];for(let i=0;i<c.length;i+=1)o[i]=pe(ie(t,c,i));return{c(){e=_("div"),e.textContent="Palette:",n=O();for(let i=0;i<o.length;i+=1)o[i].c();r=be()},m(i,f){k(i,e,f),k(i,n,f);for(let l=0;l<o.length;l+=1)o[l].m(i,f);k(i,r,f)},p(i,f){if(f&23){c=Object.entries(i[1].palettes);let l;for(l=0;l<c.length;l+=1){const s=ie(i,c,l);o[l]?o[l].p(s,f):(o[l]=pe(s),o[l].c(),o[l].m(r.parentNode,r))}for(;l<o.length;l+=1)o[l].d(1);o.length=c.length}},d(i){i&&m(e),i&&m(n),K(o,i),i&&m(r)}}}function pe(t){let e,n,r,c,o;function i(...l){return t[6](t[9],...l)}function f(...l){return t[7](t[9],...l)}return{c(){e=_("input"),g(e,"type","color"),g(e,"class","input-color-picker"),g(e,"id",n="input-color-picker-"+(t[0].category+t[11])),e.value=r=t[9][0]},m(l,s){k(l,e,s),c||(o=[D(e,"click",i),D(e,"change",f)],c=!0)},p(l,s){t=l,s&1&&n!==(n="input-color-picker-"+(t[0].category+t[11]))&&g(e,"id",n),s&2&&r!==(r=t[9][0])&&(e.value=r)},d(l){l&&m(e),c=!1,P(o)}}}function Ue(t){let e,n=t[0]&&ue(t);return{c(){n&&n.c(),e=be()},m(r,c){n&&n.m(r,c),k(r,e,c)},p(r,[c]){r[0]?n?n.p(r,c):(n=ue(r),n.c(),n.m(e.parentNode,e)):n&&(n.d(1),n=null)},i:h,o:h,d(r){n&&n.d(r),r&&m(e)}}}function Se(t){return t.toString(16).padStart(6,"0")}function Te(t){const e=t.png.palettes.map(n=>[`#${Se(n)}`,""]);return Object.fromEntries(e)}function ze(t,e,n){const r=Pe();let{resource:c=null}=e,o={category:"",priority:-1,image:null,palettes:null};Oe(()=>{f(c.images[0])});function i(p,d){document.getElementById(p).addEventListener("input",C=>{const I=C.target.value;l(d,I)})}function f(p){!c||(o.image===p?(n(1,o.image=null,o),n(1,o.palettes=null,o)):(n(1,o.image=p,o),n(1,o.palettes=Te(p),o)),r("updateConfig",{...o}))}function l(p,d){n(1,o.palettes={...o.palettes,[p]:d},o),r("updateConfig",{...o})}const s=p=>f(p),a=(p,d)=>i(d.currentTarget.id,p[0]),u=(p,d)=>{l(p[0],d.currentTarget.value),removeEventListener("input",b=>{const C=b.target.value;console.log(C),l(p[0],C)})};return t.$$set=p=>{"resource"in p&&n(0,c=p.resource)},t.$$.update=()=>{t.$$.dirty&1&&(n(1,o.category=c.category,o),n(1,o.priority=c.priority,o))},[c,o,i,f,l,s,a,u]}class De extends ee{constructor(e){super(),Z(this,e,ze,Ue,J,{resource:0})}}function xe(t){const e=PNG.sync.read(t,{filterType:-1}),n=e.data.length/4,r=new Set;for(let c=0;c<n;c++){const o=c*4;if(!e.data[o+3])continue;const f=e.data.readUInt32BE(o);let l=f;f==~~f?l=f>>8:l=(f^2147483648)>>8^8388608,r.add(l)}return e.palettes=Array.from(r),e}async function qe(t){const n=await(await fetch(t)).json();return Promise.all(n.map(async({category:r,priority:c,files:o})=>({category:r,priority:c,images:await Promise.all(o.map(async i=>{const l=await(await fetch("/zzs-avatar-editor/"+i)).blob(),s=xe(Buffer.from(await l.arrayBuffer()));return{filename:i,blob:l,url:URL.createObjectURL(l),png:s}}))})))}function Fe(...t){let e=[0,0,0,0],n;for(;n=t.shift();)if(e[3]&&n[3]){if(n[3]==255){e=Array.from(n);continue}const r=[0,0,0,0];r[3]=Math.round(n[3]+e[3]-n[3]*e[3]/255),r[0]=Math.round(n[0]*n[3]/r[3]+e[0]*e[3]*(1-n[3]/255)/r[3]),r[1]=Math.round(n[1]*n[3]/r[3]+e[1]*e[3]*(1-n[3]/255)/r[3]),r[2]=Math.round(n[2]*n[3]/r[3]+e[2]*e[3]*(1-n[3]/255)/r[3]),e=r}else e[3]==0&&(e=Array.from(n));return e}function Ge(t){let e,n,r,c,o,i,f,l;return{c(){e=_("div"),n=_("div"),r=_("canvas"),c=O(),o=_("div"),i=_("button"),i.textContent="Save Image",g(r,"id","preview-canvas"),g(r,"height","33"),g(r,"width","33"),g(r,"class","svelte-7kkhdg"),g(n,"class","canvas-container"),g(e,"class","preview svelte-7kkhdg")},m(s,a){k(s,e,a),v(e,n),v(n,r),t[3](r),v(e,c),v(e,o),v(o,i),f||(l=D(i,"click",t[1]),f=!0)},p:h,i:h,o:h,d(s){s&&m(e),t[3](null),f=!1,l()}}}function ge(t){return parseInt(t.slice(1),16)}function He(t){const n=Object.entries(t).filter(r=>r[1]&&r[1]!=r[0]).map(([r,c])=>{const o=ge(r),i=ge(c),f=(i&16711680)>>16,l=(i&65280)>>8,s=i&255;return[o,[f,l,s]]});return new Map(n)}function Je(t,e,n){let{config:r={}}=e,c;async function o(s){if(!c)return;const a=c.getContext("2d"),u=i(s);!u||a.putImageData(u,0,0)}function i(s){if(!s.length)return null;const a=s[0],{width:u,height:p}=a.image.png,d=new ImageData(u,p),b=s[0].image.png.data.length/4,C=new Map;for(let I=0;I<b;I++){const te=[],y=I*4;for(const M of s){const A=M.image.png.data;if(!C.has(M)){const w=He(M.palettes);C.set(M,w)}if(A[y+3]!=0){const w=[A[y],A[y+1],A[y+2],A[y+3]],ne=(w[0]<<16)+(w[1]<<8)+w[2],re=C.get(M);if(re.has(ne)){const x=re.get(ne);w[0]=x[0],w[1]=x[1],w[2]=x[2]}te.push(w)}}const B=Fe(...te);d.data[y]=B[0],d.data[y+1]=B[1],d.data[y+2]=B[2],d.data[y+3]=B[3]}return d}function f(){const s=document.createElement("a");s.setAttribute("download","Avatar.png"),c.toBlob(a=>{const u=URL.createObjectURL(a);s.setAttribute("href",u),s.click()})}function l(s){F[s?"unshift":"push"](()=>{c=s,n(0,c)})}return t.$$set=s=>{"config"in s&&n(2,r=s.config)},t.$$.update=()=>{if(t.$$.dirty&4){const s=Object.values(r).filter(Boolean);s.sort((a,u)=>a.priority-u.priority),o(s)}},[c,f,r,l]}class Ke extends ee{constructor(e){super(),Z(this,e,Je,Ge,J,{config:2})}}function he(t,e,n){const r=t.slice();return r[5]=e[n],r}function Qe(t){return{c:h,m:h,p:h,i:h,o:h,d:h}}function Ve(t){let e,n,r,c,o,i;n=new Ke({props:{config:t[0]}});let f=t[4],l=[];for(let a=0;a<f.length;a+=1)l[a]=_e(he(t,f,a));const s=a=>j(l[a],1,1,()=>{l[a]=null});return{c(){e=_("section"),ye(n.$$.fragment),r=O(),c=_("section"),o=_("div");for(let a=0;a<l.length;a+=1)l[a].c();g(e,"class","preview-section"),g(o,"class","container svelte-17lfb7p"),g(c,"class","config-section svelte-17lfb7p")},m(a,u){k(a,e,u),X(n,e,null),k(a,r,u),k(a,c,u),v(c,o);for(let p=0;p<l.length;p+=1)l[p].m(o,null);i=!0},p(a,u){const p={};if(u&1&&(p.config=a[0]),n.$set(p),u&6){f=a[4];let d;for(d=0;d<f.length;d+=1){const b=he(a,f,d);l[d]?(l[d].p(b,u),E(l[d],1)):(l[d]=_e(b),l[d].c(),E(l[d],1),l[d].m(o,null))}for(ve(),d=f.length;d<l.length;d+=1)s(d);ke()}},i(a){if(!i){E(n.$$.fragment,a);for(let u=0;u<f.length;u+=1)E(l[u]);i=!0}},o(a){j(n.$$.fragment,a),l=l.filter(Boolean);for(let u=0;u<l.length;u+=1)j(l[u]);i=!1},d(a){a&&m(e),Y(n),a&&m(r),a&&m(c),K(l,a)}}}function _e(t){let e,n;return e=new De({props:{resource:t[5]}}),e.$on("updateConfig",t[3]),{c(){ye(e.$$.fragment)},m(r,c){X(e,r,c),n=!0},p:h,i(r){n||(E(e.$$.fragment,r),n=!0)},o(r){j(e.$$.fragment,r),n=!1},d(r){Y(e,r)}}}function We(t){let e;return{c(){e=_("div"),e.textContent="Loading..."},m(n,r){k(n,e,r)},p:h,i:h,o:h,d(n){n&&m(e)}}}function Xe(t){let e,n,r={ctx:t,current:null,token:null,hasCatch:!1,pending:We,then:Ve,catch:Qe,value:4,blocks:[,,,]};return Ne(t[1],r),{c(){e=_("main"),r.block.c(),g(e,"class","svelte-17lfb7p")},m(c,o){k(c,e,o),r.block.m(e,r.anchor=null),r.mount=()=>e,r.anchor=null,n=!0},p(c,[o]){t=c,Re(r,t,o)},i(c){n||(E(r.block),n=!0)},o(c){for(let o=0;o<3;o+=1){const i=r.blocks[o];j(i)}n=!1},d(c){c&&m(e),r.block.d(),r.token=null,r=null}}}function Ye(t,e,n){const r=qe("/zzs-avatar-editor/parts/manifest.json");let c={};function o(f){f.image?n(0,c[f.category]=f,c):(delete c[f.category],n(0,c))}return[c,r,o,f=>o(f.detail)]}class Ze extends ee{constructor(e){super(),Z(this,e,Ye,Xe,J,{})}}new Ze({target:document.getElementById("app")});
